<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE9" />
    <link href="~/Content/Images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
    <title>登录页面</title>
    <link href="~/Content/Styles/learunui-framework.css" rel="stylesheet" />
    <script src="~/Content/Scripts/jquery/jquery-2.1.1.min.js"></script>

    <script src="~/Content/Scripts/learunui-framework.js"></script>
    <script src="~/Content/Scripts/jquery/jQuery.md5.js"></script>
    <link href="~/Content/Styles/learunui-register.css" rel="stylesheet" />
    <script src="~/Content/Scripts/cookie/jquery.cookie.js"></script>
    <script>
        /*
        检查浏览器是否支持
        */
        var isIE = !!window.ActiveXObject;
        var isIE6 = isIE && !window.XMLHttpRequest;
        if (isIE6) {
            window.location.href = "../Error/Browser";
        }
        //回车键
        document.onkeydown = function (e) {
            if (!e) e = window.event; //火狐中是 window.event
            if ((e.keyCode || e.which) == 13) {
                var btlogin = document.getElementById("btlogin");
                btlogin.focus();
                btlogin.click();
            }
        }
        $(function () {
            $("#TrueImg").hide();
            txtname()
            txtpwd();
            txtrpwd();
            code();
            txtphone();
            eamil();
            var isSend = false;
            var storage;
            $("#SendData").click(function () {

                if (!istrue) {
                    return
                } else {
                    var ph = $("#eamil").val();

                    $.ajax({
                        url: '/login/SendPost',
                        data: { txtph: ph },
                        dataType: 'json',
                        type: 'post',
                        success: function (data) {
                            alert(data.state)
                            if (data.state == 2) {
                                storage= window.localStorage;
                                storage.code = data.code;
                                storage.SendTime = data.SendTime;
                                    timeout();
                                isSend = true;
                            }

                        }, error: function () {
                            isSend = false;

                        }

                    })
                    return isSend;
                        }
               })
            //重发
            var index = 60;
            var flag;
            function timeout() {

                flag = window.setInterval(timer, 1000);

            }

            function timer() {

                index = index - 1;
                $("#SendData").text("重新发送(" + index + ")");
                istrue = false;
                if (index==1) {
                    window.clearInterval(flag);
                    if ($("#eamil").val().length < 8 || $("#eamil").val().length >= 17) {
                        $("#TextSend").html("★");
                        $("#TextSend").css("color", "#F0EEF1");
                        istrue = false;
                    } else {
                        istrue = true;
                    }
                    $("#SendData").text("发送验证 ");
                    index = 60;
                }
            }
            //验证
            $("#register").click(function () {
                alert(flagName);
                alert(flagPwd);
                alert(flagRpwd);
                alert(flagPh);
                alert(flagCode);
                alert(flagEamil);
                alert(isSend);
                if (flagName && flagPwd && flagRpwd && flagPh && flagCode && flagEamil && isSend && entable()) {

                    alert("1")
                    var pname = $("#txtname").val();
                    var ppwd = $("#txtpassword").val();

                    var pph = $("#eamil").val();
                    var pcode = $("#txtph").val();
                    var peamil = $("#code").val();
                    if (pcode != storage.code) {
                        alert("验证码不正确,请重新发送")
                        return false;
                    }
                    $.ajax({
                        url: '/Login/RegisterToSql',
                        type: 'post',
                        datatype: 'json',
                        data: { pname: pname, ppwd: ppwd, pph: pph, pcode: pcode, peamil: peamil },
                        success: function (data) {
                            alert(data.msg);
                        }
                    })
                    return true;
                } else {
                    alert();
                    return false;
                }
            })



           })

        var flagName;
        //用户名
        function txtname() {
            flagName = false;
            $("#txtname").blur(function () {
                var Name = $("#txtname").val()
                if (Name == "") {
                    $("#NameErrMsg").css("color", "red");
                    $("#NameErrMsg").append("用户名不能为空")
                    $("#TrueImg").hide();
                    flagName = false;
                    return;
                }
                var UserName = { UserName: Name };
                $.ajax({
                    url: '/Login/RegisterOnchange',
                    data: { UserName: Name },
                    dataType: 'json',
                    type: 'get',
                    success: function (data) {

                        if (data == 1) {

                            $("#NameErrMsg").css("color", "red");
                            $("#NameErrMsg").append("用户名已被注册")
                            $("#TrueImg").hide();
                            flagName = false;

                        } else {
                            $("#TrueImg").show();
                            flagName = true;
                        }
                    }
                })

            }).focus(function () {
                $("#NameErrMsg").html("★");
                $("#NameErrMsg").css("color", "#F0EEF1");

                })
            return flagName;
        }
        var flagPwd;
        function txtpwd() {
            //密码
            flagPwd = false;
            $("#txtpassword").blur(function () {
                var txtpwd = $("#txtpassword").val();

                if (txtpwd.length < 8 || txtpwd.length > 17) {

                    $("#PwdErrMsg").css("color", "red");
                    $("#PwdErrMsg").append("密码长度必须大于等于8小于等于16")
                    flagPwd = false;

                } else {
                    flagPwd = true;
                }
            }).focus(function () {
                $("#PwdErrMsg").html("★");
                $("#PwdErrMsg").css("color", "#F0EEF1");
                })
            return flagPwd;
        }

        var flagRpwd;
        function txtrpwd() {
            //确认密码
            flagRpwd = false;
            $("#txtpwd").blur(function () {
                var pwd = $("#txtpassword").val();
                var rtxtpwd = $("#txtpwd").val();
                if (rtxtpwd != pwd) {

                    $("#RpwdErrMsg").css("color", "red");
                    $("#RpwdErrMsg").append("两次输入的密码必须一样")
                    flagRpwd = false;
                } else {
                    flagRpwd = true;
                }
            }).focus(function () {
                $("#RpwdErrMsg").html("★");
                $("#RpwdErrMsg").css("color", "#F0EEF1");
                })

            return flagRpwd;
        }


        var istrue = false;
        var flagPh;
        function txtphone() {
            //手机号
            flagPh = false;
            $("#eamil").blur(function () {
                var ph = $("#eamil").val();

                if (ph.length != 11) {

                    $("#TextSend").css("color", "red");
                    $("#TextSend").append("手机号码格式有误")
                    flagPh = false;
                    istrue = false;
                } else {
                    flagPh = true
                    istrue = true;
                }

            }).focus(function () {
                $("#TextSend").html("★");
                $("#TextSend").css("color", "#F0EEF1");
                })
            return flagPh;
        }

        //验证码
        var flagCode
        function code() {
            flagCode = false;
            $("#txtph").blur(function () {
                var txtcode = $("#txtph").val();

             /*   if (txtcode != "123456") {

                    $("#PhoneErrMsg").css("color", "red");
                    $("#PhoneErrMsg").append("两次输入的密码必须一样")
                    flag = false;
                } else {}*/
                flagCode = true;

            }).focus(function () {
                $("#PhoneErrMsg").html("★");
                $("#PhoneErrMsg").css("color", "#F0EEF1");
                })
            return flagCode;
        }
        var flagEamil
        function eamil() {
            //邮箱验证
            flagEamil = false;
            $("#code").blur(function () {
                var eamil = $("#code").val();

                if (eamil != "123456") {

                    $("#CodeErrMsg").css("color", "red");
                    $("#CodeErrMsg").append("两次输入的密码必须一样")
                    flagEamil = false;
                } else {
                    flagEamil = true;
                }
            }).focus(function () {
                $("#CodeErrMsg").html("★");
                $("#CodeErrMsg").css("color", "#F0EEF1");
                })
            return flagEamil;
        }
        //登录加载
        function Load() {
            var Index = $.cookie('UItheme');
            if (Index) {
                window.location.href = '@Url.Content("~/Home/")' + Index;
        } else {
            window.location.href = '@Url.Content("~/Home/AccordionIndex")';
        }
        return false;
    }
    //提示信息
        function formMessage(msg, type) {
            var flag = false;
        $('.form-message').html('');
        $('.form-message').append('<div class="form-' + type + '-text">' + msg + '</div>');
        }

        function entable() {
            var tag = $("#check").attr("checked");

            if (tag) {

                $("#register").css({ "background-color": "#00D405", "color": "#F2F2F2" });
                return true;
            } else {
                $("#register").css({ "background-color": "#F0F0F0", "color": "#CCCDD3" });
                return false;
            }
        }


    </script>
</head>
<body class="Loginbody">
    <div class="logo">
        <img src="~/Content/Images/loginlogo.png" />
        <span id="plaseregister">请注册</span>
        <img id="zindex" src="~/Content/Images/z_index_2.png" height="680" width="595" />
    </div>
    <div class="content">

        <div style="position:relative"><img id="TrueImg" src="~/Content/Images/UserNameTrue.jpg" width="30" /></div>
        <img id="register3" src="~/Content/Images/register_meitu_3.png" width="388" />
        <div class="Loginform">

            <div class="form-message">
            </div>
            <div class="form-account">
                用户名
                <input id="txtname" type="text" />
                <div id="NameErrMsg" style="color:#F0EEF1">★</div>
            </div>
            <div class="form-password">
                密码
                <input id="txtpassword" type="password" />
                <div id="PwdErrMsg" style="color:#F0EEF1">★</div>
            </div>
            <div class="form-Rpassword">
                <div class="repwd">确认密码<input id="txtpwd" type="password" /></div>
                <div id="RpwdErrMsg" style="color:#F0EEF1">★</div>
            </div>
            <div class="form-eamil">
                <div id="eamils">手机号<input id="eamil" type="text" /></div>
                <div id="SendData" class="btlogin">发送验证</div>
                <div id="TextSend" style="color:#F0EEF1">★</div>
            </div>

            <div class="form-phone">
                <div id="phoness">验证码<input id="txtph" type="text" /></div>
                <div id="PhoneErrMsg" style="color:#F0EEF1">★</div>
            </div>
            <div class="form-code">
                <div id="codes">邮箱<input id="code" type="text" /></div>
                <div id="CodeErrMsg" style="color:#F0EEF1">★</div>
            </div>

            <div class="form-bottom">
                <div id="registerText"><input id="check" type="checkbox" checked="checked" onchange="entable()" />我已阅读并同意相关服务条款和隐私政策</div>
                <div id="register" tag="" class="btlogin">立即注册</div>
            </div>




        </div>
    </div>


</body>
</html>
